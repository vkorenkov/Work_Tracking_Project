<Window
    x:Class="NewWorkTracking.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:NewWorkTracking"
    xmlns:inter="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
    xmlns:vm="clr-namespace:NewWorkTracking.ViewModels"
    xmlns:converters="clr-namespace:NewWorkTracking.Converters"
    xmlns:behaviors="clr-namespace:NewWorkTracking.Behavior"
    xmlns:local1="clr-namespace:NewWorkTracking.Style"
    mc:Ignorable="d"
    Title="{Binding ConnectStatus}"
    Background="#1d1d1d"
    BorderBrush="#FFFFFF"
    BorderThickness="1"
    IsEnabled="{Binding Stat}"
    MinHeight="768"
    MinWidth="1333"
    Height="768"
    Width="1333"
    WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <vm:MainWindowViewModel />
    </Window.DataContext>

    <Window.Resources>
        <converters:BoolToVisibilityConverter
            x:Key="BoolToVisibilityConverter" />
        <converters:AccsessConverter
            x:Key="AccsessConverter" />
        <converters:InvConverter
            x:Key="InvConverter" />
        <converters:CharCutConverter
            x:Key="CharCutConverter" />
        <converters:RepairsTextColorConverter
            x:Key="RepairsTextColorConverter" />
    </Window.Resources>

    <Grid>
        <Grid.InputBindings>
            <KeyBinding
                Key="B"
                Modifiers="Ctrl"
                Command="{Binding Back}" />
        </Grid.InputBindings>

        <Grid.ColumnDefinitions>
            <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <!--Окно администрирования-->
        <Grid
            x:Name="Administrate"
            Margin="50 0 0 0"
            DataContext="{Binding AdministrateViewModel}"
            Visibility="{Binding ActiveVisibility}"
            d:IsHidden="True">

            <Grid.RowDefinitions>
                <RowDefinition
                    Height="255*" />
                <RowDefinition
                    Height="482*" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition
                    Width="176*" />
                <ColumnDefinition
                    Width="519*" />
                <ColumnDefinition
                    Width="580*" />
            </Grid.ColumnDefinitions>

            <ListBox
                x:Name="CatListBox"
                Margin="0 10 0 10"
                SelectedItem="{Binding CatSelected}"
                SelectedIndex="0"
                Grid.RowSpan="2">

                <ListBoxItem>
                    <TextBlock
                        Text="СцОкс" />
                </ListBoxItem>
                <ListBoxItem>
                    <TextBlock
                        Text="ОСП" />
                </ListBoxItem>
                <ListBoxItem>
                    <TextBlock
                        Text="Типы ОС" />
                </ListBoxItem>
                <ListBoxItem>
                    <TextBlock
                        Text="Результаты работ" />
                </ListBoxItem>
                <ListBoxItem>
                    <TextBlock
                        Text="Причины обращения" />
                </ListBoxItem>
                <ListBoxItem>
                    <TextBlock
                        Text="Статусы ремонта" />
                </ListBoxItem>
            </ListBox>

            <StackPanel
                Margin="20 46 20 20"
                Grid.Column="1">

                <TextBlock
                    Text="Добавить"
                    Margin="0 5 0 5" />

                <TextBox
                    x:Name="AddNewItemTextBlock"
                    Text="{Binding Item}" />

                <TextBlock
                    Text="Изменить выбранное"
                    Margin="0 5 0 5" />

                <TextBox
                    Text="{Binding SelectedItem.Name}"
                    Margin="0 5 0 5" />

                <DockPanel
                    HorizontalAlignment="Left">

                    <Button
                        Content="Добавить"
                        Margin="0 0 10 0"
                        Command="{Binding AddObject}"
                        CommandParameter="item">
                        <Button.Resources>
                            <Style
                                BasedOn="{StaticResource {x:Type Button}}"
                                TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger
                                        Binding="{Binding ElementName=AddNewItemTextBlock, Path=Text}"
                                        Value="">
                                        <Setter
                                            Property="IsEnabled"
                                            Value="False" />
                                        <Setter
                                            Property="ToolTipService.ShowOnDisabled"
                                            Value="True" />
                                        <Setter
                                            Property="ToolTip"
                                            Value="Поле 'Добавить' не заполнено" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Resources>
                    </Button>

                    <Button
                        Content="Изменить"
                        Margin="0 0 10 0"
                        Command="{Binding ChangeItem}"
                        CommandParameter="item">
                        <Button.Resources>
                            <Style
                                BasedOn="{StaticResource {x:Type Button}}"
                                TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger
                                        Binding="{Binding SelectedItem}"
                                        Value="{x:Null}">
                                        <Setter
                                            Property="IsEnabled"
                                            Value="False" />
                                        <Setter
                                            Property="ToolTipService.ShowOnDisabled"
                                            Value="True" />
                                        <Setter
                                            Property="ToolTip"
                                            Value="Выберите пользоввателя" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Resources>
                    </Button>

                    <Button
                        Content="Удалить"
                        Command="{Binding DelObject}"
                        CommandParameter="item">
                        <Button.Resources>
                            <Style
                                BasedOn="{StaticResource {x:Type Button}}"
                                TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger
                                        Binding="{Binding SelectedItem}"
                                        Value="{x:Null}">
                                        <Setter
                                            Property="IsEnabled"
                                            Value="False" />
                                        <Setter
                                            Property="ToolTipService.ShowOnDisabled"
                                            Value="True" />
                                        <Setter
                                            Property="ToolTip"
                                            Value="Выберите пользоввателя" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Resources>
                    </Button>
                </DockPanel>

            </StackPanel>

            <ListView
                Grid.Column="1"
                Grid.Row="1"
                Margin="20 0 20 10"
                ItemsSource="{Binding Items}"
                SelectedItem="{Binding SelectedItem}"
                SelectionMode="Single">

                <ListView.ItemTemplate>
                    <DataTemplate>

                        <Border
                            BorderThickness="1"
                            BorderBrush="Gray"
                            CornerRadius="3"
                            Width="340">
                            <StackPanel>
                                <TextBlock
                                    Text="{Binding Name}"
                                    FontSize="13" />
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <StackPanel
                Margin="20"
                Grid.Column="2">

                <TextBlock
                    Text="Добавить Пользователя"
                    Margin="0 5 0 5" />

                <TextBlock
                    Text="Введите Ф.И.О"
                    Margin="0 5 0 5" />

                <TextBox
                    x:Name="AddNewUserTextBox"
                    Text="{Binding NewUser}" />

                <TextBlock
                    Text="Выберите уровень доступа"
                    Margin="0 5 0 5" />

                <ComboBox
                    IsEditable="False"
                    ItemsSource="{Binding AccessLevels}"
                    SelectedItem="{Binding AccessLevel}">

                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock
                                Text="{Binding Converter={StaticResource AccsessConverter}}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>

                </ComboBox>

                <TextBlock
                    Text="Изменить выбранное"
                    Margin="0 5 0 5" />

                <DockPanel
                    Margin="0 5 0 5">

                    <TextBox
                        Text="{Binding SelectedAdmin.Name}" />

                    <ComboBox
                        IsEditable="False"
                        ItemsSource="{Binding AccessLevels}"
                        SelectedItem="{Binding SelectedAdmin.Access}">

                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock
                                    Text="{Binding Converter={StaticResource AccsessConverter}}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>

                    </ComboBox>

                </DockPanel>

                <DockPanel
                    HorizontalAlignment="Left">

                    <Button
                        Content="Добавить"
                        Command="{Binding AddObject}"
                        CommandParameter="User"
                        Margin="0 0 10 0">
                        <Button.Resources>
                            <Style
                                BasedOn="{StaticResource {x:Type Button}}"
                                TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger
                                        Binding="{Binding ElementName=AddNewUserTextBox, Path=Text}"
                                        Value="">
                                        <Setter
                                            Property="IsEnabled"
                                            Value="False" />
                                        <Setter
                                            Property="ToolTipService.ShowOnDisabled"
                                            Value="True" />
                                        <Setter
                                            Property="ToolTip"
                                            Value="Поле 'Ф.И.О' не заполнено" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Resources>
                    </Button>

                    <Button
                        Content="Изменить"
                        Command="{Binding ChangeItem}"
                        CommandParameter="User"
                        Margin="0 0 10 0">
                        <Button.Resources>
                            <Style
                                BasedOn="{StaticResource {x:Type Button}}"
                                TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger
                                        Binding="{Binding SelectedAdmin}"
                                        Value="{x:Null}">
                                        <Setter
                                            Property="IsEnabled"
                                            Value="False" />
                                        <Setter
                                            Property="ToolTipService.ShowOnDisabled"
                                            Value="True" />
                                        <Setter
                                            Property="ToolTip"
                                            Value="Выберите пользоввателя" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Resources>
                    </Button>

                    <Button
                        Content="Удалить"
                        Command="{Binding DelObject}"
                        CommandParameter="User">
                        <Button.Resources>
                            <Style
                                BasedOn="{StaticResource {x:Type Button}}"
                                TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger
                                        Binding="{Binding SelectedAdmin}"
                                        Value="{x:Null}">
                                        <Setter
                                            Property="IsEnabled"
                                            Value="False" />
                                        <Setter
                                            Property="ToolTipService.ShowOnDisabled"
                                            Value="True" />
                                        <Setter
                                            Property="ToolTip"
                                            Value="Выберите пользоввателя" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Resources>
                    </Button>

                </DockPanel>

            </StackPanel>

            <ListView
                Grid.Column="2"
                Grid.Row="1"
                Margin="20 0 20 10"
                ItemsSource="{Binding MainObject.ComboBox.Accesses}"
                SelectedItem="{Binding SelectedAdmin}"
                SelectionMode="Single">

                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border
                            BorderThickness="1"
                            BorderBrush="Gray"
                            CornerRadius="3"
                            Width="340">
                            <StackPanel>
                                <DockPanel>
                                    <TextBlock
                                        Foreground="{StaticResource GoldenBrush}"
                                        Text="Пользователь: " />
                                    <TextBlock
                                        Text="{Binding Name}"
                                        FontSize="13" />
                                </DockPanel>
                                <DockPanel>
                                    <TextBlock
                                        Foreground="{StaticResource GoldenBrush}"
                                        Text="Доступ: " />
                                    <TextBlock
                                        Text="{Binding Access, Converter={StaticResource AccsessConverter}}" />
                                </DockPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

        </Grid>

        <!--Окно Мои заявки-->
        <Grid
            Name="UserWorks"
            Margin="50 0 0 0"
            DataContext="{Binding UserWorksViewModel}"
            Visibility="{Binding ActiveVisibility}"
            d:IsHidden="True">

            <Grid.ColumnDefinitions>
                <ColumnDefinition
                    Name="UserOrdersGridSplit"
                    Width="305"
                    MaxWidth="400" />
                <ColumnDefinition
                    Width="322*" />
            </Grid.ColumnDefinitions>

            <GridSplitter
                Width="5">

                <!--<GridSplitter.Triggers>
                    <EventTrigger
                        RoutedEvent="MouseRightButtonUp">
                        <EventTrigger.Actions>
                            <BeginStoryboard>
                                <Storyboard
                                    TargetName="UserOrdersGridSplit"
                                    TargetProperty="Width">
                                    <ObjectAnimationUsingKeyFrames
                                        BeginTime="0" Duration="0:0:0.2">
                                        <DiscreteObjectKeyFrame
                                            KeyTime="0">
                                            <DiscreteObjectKeyFrame.Value>
                                                <GridLength>*</GridLength>
                                            </DiscreteObjectKeyFrame.Value>
                                        </DiscreteObjectKeyFrame>
                                    </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger.Actions>
                    </EventTrigger>
                </GridSplitter.Triggers>-->
            </GridSplitter>

            <ScrollViewer
                Margin="0 0 8 0"
                VerticalScrollBarVisibility="Hidden"
                HorizontalScrollBarVisibility="Auto">

                <StackPanel>

                    <TextBlock
                        Text="Дата"
                        Margin="0 5 0 5" />

                    <DatePicker
                        SelectedDate="{Binding NewWork.Date}" />

                    <TextBlock
                        Text="Системный администратор"
                        Margin="0 5 0 5" />

                    <TextBlock
                        Text="{Binding MainObject.Access.Name}"
                        FontFamily="Arial Bold"
                        Visibility="{Binding Path=NamesVisibilityCheck, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <TextBlock
                        Text="Осп выполнения работ"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.OspList}"
                        Text="{Binding NewWork.OspWork}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Осп заказчика"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.OspList}"
                        Text="{Binding NewWork.OspOrder}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Тип заявки"
                        Margin="0 5 0 5" />

                    <ComboBox
                        Text="{Binding NewWork.OrderType}">
                        <ComboBoxItem>
                            <TextBlock
                                Text="Заявка ОКС" />
                        </ComboBoxItem>
                        <ComboBoxItem>
                            <TextBlock
                                Text="Инцидент" />
                        </ComboBoxItem>
                    </ComboBox>

                    <TextBlock
                        Text="Номер заявки"
                        Margin="0 5 0 5" />

                    <TextBox
                        Text="{Binding NewWork.OrderNum, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource InvConverter}}" />

                    <TextBlock
                        Text="Инвентарный номер неисправного устройства"
                        Margin="0 5 0 5" />

                    <TextBox
                        Text="{Binding NewWork.OldInv, Converter={StaticResource CharCutConverter}}"
                        MaxLength="12" />

                    <TextBlock
                        Text="Инвентарный номер нового устройства"
                        Margin="0 5 0 5" />

                    <DockPanel>
                        <TextBox
                            Width="200"
                            Text="{Binding NewWork.NewInv, Converter={StaticResource CharCutConverter}}"
                            MaxLength="12" />

                        <CheckBox
                            HorizontalAlignment="Right"
                            Content="Не менялся"
                            Margin="0 0 12 0"
                            IsChecked="{Binding NoNewInvNumCheck}" />
                    </DockPanel>

                    <TextBlock
                        Text="Старое имя ПК"
                        Margin="0 5 0 5" />

                    <DockPanel>
                        <TextBox
                            Width="200"
                            Text="{Binding NewWork.OldPCName}" />

                        <CheckBox
                            HorizontalAlignment="Right"
                            Content="Без имени ПК"
                            IsChecked="{Binding NoPcNameCheck}" />
                    </DockPanel>

                    <TextBlock
                        Text="Тип ОС"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                        Text="{Binding NewWork.OsType}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Причина обращения"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.WhyList}"
                        Text="{Binding NewWork.Why}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Зезультат работ"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.ResultsList}"
                        Text="{Binding NewWork.Results}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Заявленная неисправность"
                        Margin="0 5 0 5" />

                    <TextBox
                        Text="{Binding NewWork.Brocken}" />

                    <TextBlock
                        Text="Выполнение"
                        Margin="0 5 0 5" />

                    <TextBox
                        Text="{Binding NewWork.Pass}" />

                    <Button
                        HorizontalAlignment="Left"
                        Margin="0 10 0 0"
                        Content="Добавить"
                        Command="{Binding AddWork}" />

                    <Button
                        HorizontalAlignment="Left"
                        Margin="0 10 0 0"
                        Content="test"
                        Command="{Binding AddManyWork}"
                        Visibility="Hidden" />


                </StackPanel>
            </ScrollViewer>

            <DataGrid
                x:Name="UseWorksTable"
                Margin="-2,0,0,0"
                Grid.Column="2"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserReorderColumns="False"
                HeadersVisibility="Column"
                CanUserDeleteRows="False"
                CanUserResizeRows="False"
                CanUserSortColumns="False"
                IsReadOnly="True"
                ItemsSource="{Binding UsersWorks, UpdateSourceTrigger=PropertyChanged}">

                <DataGrid.Columns>
                    <DataGridTextColumn
                        Header="Дата"
                        Binding="{Binding Date, StringFormat=\{0:dd.MM.yyy\}, UpdateSourceTrigger=PropertyChanged}"
                        Width="90" />

                    <DataGridTextColumn
                        Header="Системный Администратор"
                        Binding="{Binding Who}"
                        Width="160"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="ОСП выполнения"
                        Binding="{Binding OspWork}"
                        Width="130"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="ОСП заказчика"
                        Binding="{Binding OspOrder}"
                        Width="130"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Вид заявки"
                        Binding="{Binding OrderType}"
                        Width="90"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Номер заявки"
                        Binding="{Binding OrderNum}"
                        Width="90"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Инвентарный номер снятого"
                        Binding="{Binding OldInv}"
                        Width="170"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Инвентарный номер нового"
                        Binding="{Binding NewInv}"
                        Width="170"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Старое имя ПК"
                        Binding="{Binding OldPCName}"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Тип ОС"
                        Binding="{Binding OsType}"
                        Width="120"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Причина обращения"
                        Binding="{Binding Why}"
                        Width="120"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Результат"
                        Binding="{Binding Results}"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Заявленная неиспраность"
                        Binding="{Binding Brocken}"
                        Width="180"
                        ElementStyle="{StaticResource Wrap}" />

                    <DataGridTextColumn
                        Header="Выполнение"
                        Binding="{Binding Pass}"
                        ElementStyle="{StaticResource Wrap}" />
                </DataGrid.Columns>

            </DataGrid>

        </Grid>

        <!--Окно все заявки-->
        <Grid
            x:Name="AllWorks"
            Margin="50 0 0 0"
            DataContext="{Binding AllWorksViewModel}"
            Visibility="{Binding ActiveVisibility}"
            d:IsHidden="False">

            <Grid.RowDefinitions>
                <RowDefinition />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition
                    Width="300"
                    MaxWidth="400" />
                <ColumnDefinition
                    Width="705*" />
            </Grid.ColumnDefinitions>

            <GridSplitter
                Width="3" />

            <ScrollViewer
                Margin="0 0 10 0"
                VerticalScrollBarVisibility="Hidden"
                HorizontalScrollBarVisibility="Auto">

                <StackPanel>

                    <TextBlock
                        Text="Начало периода"
                        Margin="0 5 0 5" />

                    <DatePicker
                        SelectedDate="{Binding Filter.DateOne}" />

                    <TextBlock
                        Text="Конец периода"
                        Margin="0 5 0 5" />

                    <DatePicker
                        SelectedDate="{Binding Filter.DateTwo}" />

                    <TextBlock
                        Text="Фильтр по системному админнистратору"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.Accesses}"
                        Text="{Binding Filter.AdminFilter}"
                        DisplayMemberPath="Name"
                        Visibility="{Binding NamesVisibilityCheck, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <TextBlock
                        Text="Фильтр по типу заявки"
                        Margin="0 5 0 5" />

                    <ComboBox
                        Text="{Binding Filter.OrderType}">
                        <ComboBoxItem
                            Content="Заявка ОКС" />
                        <ComboBoxItem
                            Content="Инцидент" />
                    </ComboBox>

                    <TextBlock
                        Text="Фильтр по осп выполнения"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.OspList}"
                        Text="{Binding Filter.OspWorkFilter}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Фильтр по осп заказчика"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.OspList}"
                        Text="{Binding Filter.OspOrderFilter}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Фильтр по типу ОС"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                        Text="{Binding Filter.OsTypeFilter}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Фильтр по причинам обращения"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.WhyList}"
                        Text="{Binding Filter.ReasonFilter}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Фильтр по результатам работы"
                        Margin="0 5 0 5" />

                    <ComboBox
                        ItemsSource="{Binding MainObject.ComboBox.ResultsList}"
                        Text="{Binding Filter.ResultFilter}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Text="Поиск"
                        Margin="0 5 0 5" />

                    <TextBox
                        Text="{Binding Filter.SearchLine, UpdateSourceTrigger=PropertyChanged}" />

                    <TextBlock
                        Text="{Binding Status}"
                        Margin="10" />

                    <StackPanel
                        Orientation="Horizontal"
                        VerticalAlignment="Top">

                        <Button
                            Margin="10 0 5 0"
                            Width="90"
                            FontSize="10"
                            Content="Выгрузить в Excel"
                            Command="{Binding UploadExcel}" />

                        <Button
                            Margin="0 0 5 0"
                            Width="90"
                            Content="Обновить"
                            Command="{Binding Refresh}" />

                        <Button
                            Width="90"
                            FontSize="10"
                            Content="Очистить фильтры"
                            Command="{Binding RefreshFilters}" />

                    </StackPanel>

                </StackPanel>

            </ScrollViewer>

            <Grid
                Grid.Column="1">

                <Grid.RowDefinitions>
                    <RowDefinition
                        Height="317*" />
                    <RowDefinition
                        Height="9*" />
                    <RowDefinition
                        Height="409*" />
                </Grid.RowDefinitions>

                <GridSplitter
                    Grid.Row="1"
                    Margin="0,5,0,2"
                    Height="3"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center" />

                <DataGrid
                    Grid.Row="0"
                    x:Name="tableControl"
                    BorderThickness="0.5"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    CanUserReorderColumns="True"
                    HeadersVisibility="Column"
                    CanUserDeleteRows="True"
                    VirtualizingPanel.ScrollUnit="Pixel"
                    SelectionUnit="FullRow"
                    SelectionMode="Extended"
                    IsReadOnly="True"
                    ItemsSource="{Binding UsersWorks, UpdateSourceTrigger=PropertyChanged}"
                    SelectedItem="{Binding SelectedOrder, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">

                    <inter:Interaction.Behaviors>
                        <behaviors:DataGridBehavior />
                    </inter:Interaction.Behaviors>

                    <DataGrid.ContextMenu>
                        <ContextMenu>

                            <MenuItem
                                Header="Выгрузить выделенное в Excel"
                                Command="{Binding UploadExcel}" />

                            <MenuItem
                                Command="Copy" />

                            <MenuItem
                                Header="Пометить как 'Архив'"
                                Command="{Binding OrderStatus}" />

                            <MenuItem
                                Header="Удалить из отчета"
                                Command="{Binding RemoveFromReport}" />

                        </ContextMenu>

                    </DataGrid.ContextMenu>

                    <DataGrid.Columns>

                        <DataGridTextColumn
                            Header="Дата"
                            Binding="{Binding Date, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Системный Администратор"
                            Binding="{Binding Who}"
                            Width="160"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="ОСП выполнения"
                            Binding="{Binding OspWork}"
                            Width="130"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="ОСП заказчика"
                            Binding="{Binding OspOrder}"
                            Width="130"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Вид заявки"
                            Binding="{Binding OrderType}"
                            Width="140"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Номер заявки"
                            Binding="{Binding OrderNum}"
                            Width="90"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Инвентарный номер снятого"
                            Binding="{Binding OldInv}"
                            Width="170"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Инвентарный номер нового"
                            Binding="{Binding NewInv}"
                            Width="170"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Старое имя ПК"
                            Binding="{Binding OldPCName}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Тип ОС"
                            Binding="{Binding OsType}"
                            Width="120"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Причина обращения"
                            Binding="{Binding Why}"
                            Width="120"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Результат"
                            Binding="{Binding Results}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Заявленная неиспраность"
                            Binding="{Binding Brocken}"
                            Width="180"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Выполнение"
                            Width="220"
                            Binding="{Binding Pass}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Статус заявки"
                            Width="150"
                            Binding="{Binding NoActive}"
                            ElementStyle="{StaticResource Wrap}" />

                    </DataGrid.Columns>

                    <DataGrid.Resources>
                        <Style
                            BasedOn="{StaticResource {x:Type DataGridCell}}"
                            TargetType="DataGridCell">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Активно">
                                    <Setter
                                        Property="Foreground"
                                        Value="#FFFFFF" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="#FFFFFF" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Архив">
                                    <Setter
                                        Property="Foreground"
                                        Value="Red" />
                                    <Setter
                                        Property="Background"
                                        Value="#1d1d1d" />
                                    <Setter
                                        Property="BorderThickness"
                                        Value="0.3" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="#FFFFFF" />
                                </DataTrigger>
                                <Trigger
                                    Property="IsSelected"
                                    Value="True">
                                    <Setter
                                        Property="Background"
                                        Value="#373737" />
                                </Trigger>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Активно">
                                    <Setter
                                        Property="Foreground"
                                        Value="{StaticResource WhiteBrush}" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="{StaticResource WhiteBrush}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Архив">
                                    <Setter
                                        Property="Foreground"
                                        Value="Red" />
                                    <Setter
                                        Property="BorderThickness"
                                        Value="0.3" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="{StaticResource WhiteBrush}" />
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Необходимо заполнить номер списания">
                                    <Setter
                                        Property="Foreground"
                                        Value="{StaticResource OrangeBrush}" />
                                    <Setter
                                        Property="BorderThickness"
                                        Value="0.3" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="{StaticResource WhiteBrush}" />
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Необходимо заполнить номер модернизации или списания">
                                    <Setter
                                        Property="Foreground"
                                        Value="{StaticResource OrangeBrush}" />
                                    <Setter
                                        Property="BorderThickness"
                                        Value="0.3" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="{StaticResource WhiteBrush}" />
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Списано">
                                    <Setter
                                        Property="Foreground"
                                        Value="{StaticResource LightBlue}" />
                                    <Setter
                                        Property="BorderThickness"
                                        Value="0.3" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="{StaticResource WhiteBrush}" />
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding NoActive}"
                                    Value="Модернизировано">
                                    <Setter
                                        Property="Foreground"
                                        Value="Green" />
                                    <Setter
                                        Property="BorderThickness"
                                        Value="0.3" />
                                    <Setter
                                        Property="BorderBrush"
                                        Value="{StaticResource WhiteBrush}" />
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                                <Trigger
                                    Property="IsSelected"
                                    Value="True">
                                    <Setter
                                        Property="Background"
                                        Value="#373737" />
                                    <Setter
                                        Property="BorderThickness"
                                        Value="0.3" />
                                    <!--<Setter Property="Foreground" Value="{StaticResource WhiteBrush}"/>-->
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.Resources>

                </DataGrid>

                <!--Карточка работы-->
                <ScrollViewer
                    Margin="0 10 20 10"
                    Grid.Row="2"
                    VirtualizingPanel.ScrollUnit="Pixel"
                    VerticalScrollBarVisibility="Hidden">
                    <DockPanel>

                        <Grid
                            Margin="20 0 0 20">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition
                                    Width="448*"
                                    MaxWidth="650" />
                                <ColumnDefinition
                                    Width="482*"
                                    MaxWidth="650" />
                            </Grid.ColumnDefinitions>

                            <StackPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Дата выполнения"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <DatePicker
                                        Width="200"
                                        Height="24"
                                        SelectedDate="{Binding SelectedOrder.Date}"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Кто выполнял"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <ComboBox
                                        Text="{Binding SelectedOrder.Who}"
                                        ItemsSource="{Binding MainObject.ComboBox.Accesses}"
                                        DisplayMemberPath="Name"
                                        Width="200"
                                        HorizontalAlignment="Right"
                                        Visibility="{Binding NamesVisibilityCheck, Converter={StaticResource BoolToVisibilityConverter}}" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="ОСП выполнения"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <ComboBox
                                        Text="{Binding SelectedOrder.OspWork}"
                                        ItemsSource="{Binding MainObject.ComboBox.OspList}"
                                        DisplayMemberPath="Name"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="ОСП заказчика"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <ComboBox
                                        Text="{Binding SelectedOrder.OspOrder}"
                                        ItemsSource="{Binding MainObject.ComboBox.OspList}"
                                        DisplayMemberPath="Name"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Вид заявки"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Text="{Binding SelectedOrder.OrderType}"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Номер заявки"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Text="{Binding SelectedOrder.OrderNum, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource InvConverter}}"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Инв. Номер снятого"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Text="{Binding SelectedOrder.OldInv, Converter={StaticResource CharCutConverter}}"
                                        MaxLength="12"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Номер списания"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Name="WriteOff"
                                        Text="{Binding SelectedOrder.WriteOffNum, UpdateSourceTrigger=PropertyChanged}"
                                        Width="200"
                                        IsEnabled="{Binding SelectedOrder.VisWriteOff}"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="№ Модернизации"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Name="Modern"
                                        Text="{Binding SelectedOrder.ModernNum, UpdateSourceTrigger=PropertyChanged}"
                                        Width="200"
                                        IsEnabled="{Binding SelectedOrder.VisModernNum}"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="№ модернизации нового ПК"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left"
                                        Width="120" />

                                    <TextBox
                                        Name="ModernNewPC"
                                        Text="{Binding SelectedOrder.ModernNewPc, UpdateSourceTrigger=PropertyChanged}"
                                        Width="200"
                                        IsEnabled="{Binding SelectedOrder.VisModernNewPc}"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <StackPanel
                                    VerticalAlignment="Bottom"
                                    Orientation="Horizontal">

                                    <Button
                                        Margin="10 0 0 0"
                                        IsEnabled="True"
                                        Content="Записать"
                                        Command="{Binding ChangeWork}" />

                                </StackPanel>

                            </StackPanel>

                            <StackPanel
                                Grid.Column="1"
                                Margin="20 0 0 0">

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Инв. номер нового"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Text="{Binding SelectedOrder.NewInv, Converter={StaticResource CharCutConverter}}"
                                        MaxLength="12"
                                        Width="200"
                                        HorizontalAlignment="Right" />
                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Старое имя ПК"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Text="{Binding SelectedOrder.OldPCName}"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Тип ОС"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <ComboBox
                                        Text="{Binding SelectedOrder.OsType}"
                                        ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                                        DisplayMemberPath="Name"
                                        Width="200"
                                        HorizontalAlignment="Right" />
                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Причина обращения"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <ComboBox
                                        Text="{Binding SelectedOrder.Why}"
                                        ItemsSource="{Binding MainObject.ComboBox.WhyList}"
                                        DisplayMemberPath="Name"
                                        Width="200"
                                        HorizontalAlignment="Right" />
                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Результат"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left" />

                                    <ComboBox
                                        Text="{Binding SelectedOrder.Results}"
                                        ItemsSource="{Binding MainObject.ComboBox.ResultsList}"
                                        DisplayMemberPath="Name"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Заявленная неисправность"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        TextWrapping="Wrap"
                                        Width="104"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Text="{Binding SelectedOrder.Brocken}"
                                        Width="200"
                                        Height="70"
                                        TextWrapping="Wrap"
                                        VerticalContentAlignment="Bottom"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel
                                    Margin="0 0 0 10">

                                    <TextBlock
                                        Text="Выполнение"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        Width="100"
                                        HorizontalAlignment="Left" />

                                    <TextBox
                                        Text="{Binding SelectedOrder.Pass}"
                                        Width="200"
                                        Height="70"
                                        TextWrapping="Wrap"
                                        VerticalContentAlignment="Bottom"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                                <DockPanel>

                                    <TextBlock
                                        Text="Статус заявки"
                                        FontSize="15"
                                        Margin="10 0 0 0"
                                        VerticalAlignment="Center"
                                        Width="110"
                                        HorizontalAlignment="Left" />

                                    <ComboBox
                                        ItemsSource="{Binding OrderActivity}"
                                        SelectedItem="{Binding SelectedOrder.NoActive}"
                                        Width="200"
                                        HorizontalAlignment="Right" />

                                </DockPanel>

                            </StackPanel>

                        </Grid>

                    </DockPanel>
                </ScrollViewer>
            </Grid>

        </Grid>

        <!--Окно Все ремонты-->
        <Grid
            x:Name="AllRepairs"
            Margin="50 0 0 0"
            DataContext="{Binding RepairsViewModel}"
            Visibility="{Binding ActiveVisibility}"
            d:IsHidden="True">

            <Grid.ColumnDefinitions>
                <ColumnDefinition
                    Width="300"
                    MaxWidth="400" />
                <ColumnDefinition
                    Width="705*" />
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition />
            </Grid.RowDefinitions>

            <GridSplitter
                Width="3" />

            <ScrollViewer
                Margin="0 0 8 0"
                VerticalScrollBarVisibility="Hidden"
                HorizontalScrollBarVisibility="Auto">
                <StackPanel>

                    <TextBlock
                        Margin="5">
                                <Bold>Фильтр по дате отгрузки</Bold>
                    </TextBlock>

                    <TextBlock
                        Margin="5">
                                <Bold>Начало периода</Bold>
                    </TextBlock>

                    <DatePicker
                        Margin="5"
                        SelectedDate="{Binding Filter.DateOne}">

                    </DatePicker>

                    <TextBlock
                        Margin="5">
                                <Bold>Конец периода</Bold>
                    </TextBlock>

                    <DatePicker
                        Margin="5"
                        SelectedDate="{Binding Filter.DateTwo}">

                    </DatePicker>

                    <TextBlock
                        Margin="5">
                                <Bold>Фильтрация по статусу</Bold>
                    </TextBlock>

                    <ComboBox
                        Margin="5"
                        ItemsSource="{Binding MainObject.ComboBox.RepairStatus}"
                        Text="{Binding Filter.SelectedStatus}"
                        DisplayMemberPath="Name" />

                    <Separator
                        Margin="7 -10 5 0" />

                    <TextBlock
                        Margin="5">
                                <Bold>Фильтрация по модели</Bold>
                    </TextBlock>

                    <ComboBox
                        Margin="5"
                        ItemsSource="{Binding FilterModelList}"
                        Text="{Binding Filter.SelectedModel}" />

                    <TextBlock
                        Margin="5">
                                <Bold>Фильтрация по СЦ ОКС</Bold>
                    </TextBlock>

                    <ComboBox
                        Margin="5"
                        ItemsSource="{Binding MainObject.ComboBox.ScOks}"
                        Text="{Binding Filter.SelectedScOks}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Margin="5">
                                <Bold>Фильтрация по КА поставщик</Bold>
                    </TextBlock>

                    <ComboBox
                        Margin="5"
                        ItemsSource="{Binding FilterProviderList}"
                        Text="{Binding Filter.SelectedKaProvider}" />

                    <TextBlock
                        Margin="5">
                                <Bold>Фильтрация по типу ОС</Bold>
                    </TextBlock>

                    <ComboBox
                        Margin="5"
                        ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                        Text="{Binding Filter.SelectedOsName}"
                        DisplayMemberPath="Name" />

                    <TextBlock
                        Margin="5">
                                <Bold>Фильтрация по типу ремонта</Bold>
                    </TextBlock>

                    <ComboBox
                        Margin="5"
                        ItemsSource="{Binding FilterRepairTypeList}"
                        Text="{Binding Filter.SelectedWaranty}" />

                    <TextBlock
                        Margin="0 0 0 5"
                        Text="Поиск" />

                    <TextBox
                        Margin="10 0 10 0"
                        Tag="Введите запрос"
                        Text="{Binding Filter.SearchLine, UpdateSourceTrigger=PropertyChanged}" />

                    <DockPanel
                        Grid.Row="1"
                        VerticalAlignment="Top">

                        <Button
                            x:Name="btnCleanRepairs"
                            Command="{Binding RefreshFilters}"
                            Margin="10 10 0 0"
                            HorizontalAlignment="Left"
                            IsEnabled="True"
                            Canvas.Top="8"
                            Canvas.Left="12">

                            <TextBlock
                                Text="Очистить фильтр"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                FontSize="9" />

                        </Button>

                        <Button
                            x:Name="btnAddRepair"
                            Command="{Binding OpenCleanRepairCard}"
                            Margin="10 10 0 0"
                            HorizontalAlignment="Left"
                            IsEnabled="True"
                            Canvas.Top="8"
                            Canvas.Left="12">

                            <TextBlock
                                Text="Добавить ремонт"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                FontSize="9" />

                        </Button>

                    </DockPanel>

                </StackPanel>
            </ScrollViewer>

            <Grid
                Grid.Column="1">

                <Grid.RowDefinitions>
                    <RowDefinition
                        Height="332*" />
                    <RowDefinition
                        Height="Auto" />
                    <RowDefinition
                        Height="397*" />
                </Grid.RowDefinitions>

                <GridSplitter
                    Grid.Row="1"
                    Margin="0 10 0 10"
                    Height="3"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center" />

                <DataGrid
                    BorderThickness="0.5"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    CanUserReorderColumns="True"
                    HeadersVisibility="Column"
                    CanUserDeleteRows="True"
                    VirtualizingPanel.ScrollUnit="Pixel"
                    SelectionUnit="FullRow"
                    SelectionMode="Extended"
                    IsReadOnly="True"
                    ItemsSource="{Binding UsersWorks, UpdateSourceTrigger=PropertyChanged}"
                    SelectedItem="{Binding SelectedRepair, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">

                    <DataGrid.ContextMenu>
                        <ContextMenu>

                            <MenuItem
                                Header="Выгрузить выделенное в Excel (пока недоступно)"
                                IsEnabled="False"
                                Command="{Binding GetExcel}" />

                            <MenuItem
                                Header="Копировать"
                                Command="Copy" />

                            <MenuItem
                                Header="Отобразить все"
                                Command="{Binding SeeAll}" />

                            <MenuItem
                                Header="Бюджетирование ремонтов"
                                Command="{Binding BudgetingRepairs}" />

                            <CheckBox
                                Content="Дата"
                                IsChecked="{Binding HideColumns.Date}" />

                            <CheckBox
                                Content="Статус"
                                IsChecked="{Binding HideColumns.Status}" />

                            <CheckBox
                                Content="Наименование"
                                IsChecked="{Binding HideColumns.OsName}" />

                            <CheckBox
                                Content="Модель"
                                IsChecked="{Binding HideColumns.Model}" />

                            <CheckBox
                                Content="Серийный номер"
                                IsChecked="{Binding HideColumns.SNumber}" />

                            <CheckBox
                                Content="Инв.номмер"
                                IsChecked="{Binding HideColumns.InvNumber}" />

                            <CheckBox
                                Content="СЦ ОКС"
                                IsChecked="{Binding HideColumns.ScOks}" />

                            <CheckBox
                                Content="Основание"
                                IsChecked="{Binding HideColumns.DiagNumber}" />

                            <CheckBox
                                Content="КА поставщика"
                                IsChecked="{Binding HideColumns.KaProvider}" />

                            <CheckBox
                                Content="КА ремонта"
                                IsChecked="{Binding HideColumns.KaRepair}" />

                            <CheckBox
                                Content="Передал"
                                IsChecked="{Binding HideColumns.HandedOver}" />

                            <CheckBox
                                Content="Неисправность"
                                IsChecked="{Binding HideColumns.Defect}" />

                            <CheckBox
                                Content="Дата отгрузки"
                                IsChecked="{Binding HideColumns.ShipmentDate}" />

                            <CheckBox
                                Content="Дней в ремонте"
                                IsChecked="{Binding HideColumns.DaysOfRepair}" />

                            <CheckBox
                                Content="Вернулось из ремонта"
                                IsChecked="{Binding HideColumns.ReturnFromRepair}" />

                            <CheckBox
                                Content="Номер заявки поставщика СЦ"
                                IsChecked="{Binding HideColumns.ProviderOrder}" />

                            <CheckBox
                                Content="Согласование стоимости ремонта"
                                IsChecked="{Binding HideColumns.RepairBill}" />

                            <CheckBox
                                Content="Основание гарантии"
                                IsChecked="{Binding HideColumns.WarrantyBasis}" />

                            <CheckBox
                                Content="Дата начала гарантии"
                                IsChecked="{Binding HideColumns.StartWarranty}" />

                            <CheckBox
                                Content="Тип ремонта"
                                IsChecked="{Binding HideColumns.Warranty}" />

                        </ContextMenu>
                    </DataGrid.ContextMenu>

                    <!--<DataGrid.CellStyle>
                        <Style
                            BasedOn="{StaticResource {x:Type DataGridCell}}"
                            TargetType="DataGridCell">
                            <Setter
                                Property="Foreground"
                                Value="{Binding Path=DaysOfRepair, Converter={StaticResource RepairsTextColorConverter}}" />
                        </Style>
                    </DataGrid.CellStyle>-->

                    <inter:Interaction.Behaviors>
                        <behaviors:DataGridBehavior />
                    </inter:Interaction.Behaviors>

                    <DataGrid.Columns>

                        <DataGridTextColumn
                            x:Name="dateColumn"
                            Header="Дата"
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.Date, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Binding="{Binding Date, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.Status, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Статус"
                            Binding="{Binding Status}">

                            <DataGridTextColumn.ElementStyle>
                                <Style
                                    TargetType="TextBlock">
                                    <Setter
                                        Property="Foreground"
                                        Value="{Binding Status, Converter={StaticResource RepairsTextColorConverter}}" />
                                    <Setter
                                        Property="TextWrapping"
                                        Value="Wrap" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>

                        </DataGridTextColumn>

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.OsName, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Наименование"
                            Binding="{Binding OsName}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.Model, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Модель"
                            Binding="{Binding Model}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.SNumber, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Серийный нномер"
                            Binding="{Binding SNumber}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.InvNumber, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Инв.номер"
                            Binding="{Binding InvNumber}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.InvNumber, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="СЦ ОКС"
                            Binding="{Binding ScOks}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.DiagNumber, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Основание"
                            Binding="{Binding DiagNumber}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.KaProvider, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="КА поставщик"
                            Binding="{Binding KaProvider}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.KaRepair, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="КА ремонт"
                            Binding="{Binding KaRepair}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.HandedOver, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Передал"
                            Binding="{Binding HandedOver}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.Defect, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Неисправность"
                            Binding="{Binding Defect}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.ShipmentDate, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Дата отгрузки"
                            Binding="{Binding ShipmentDate, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.DaysOfRepair, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Дней в ремонте"
                            Binding="{Binding DaysOfRepair}">

                            <DataGridTextColumn.ElementStyle>
                                <Style
                                    TargetType="TextBlock">
                                    <Setter
                                        Property="Foreground"
                                        Value="{Binding DaysOfRepair, Converter={StaticResource RepairsTextColorConverter}}" />
                                    <Setter
                                        Property="TextWrapping"
                                        Value="Wrap" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>

                        </DataGridTextColumn>

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.ReturnFromRepair, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Вернулось из ремонта"
                            Binding="{Binding ReturnFromRepair, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.ProviderOrder, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Номер заявки поставщика СЦ"
                            Binding="{Binding ProviderOrder}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.RepairBill, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Согласованная стоимость ремонта"
                            Binding="{Binding RepairBill}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.WarrantyBasis, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Основание гарантии"
                            Binding="{Binding WarrantyBasis}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.StartWarranty, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Дата начала гарантии"
                            Binding="{Binding StartWarranty, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Visibility="{Binding (FrameworkElement.DataContext).HideColumns.Warranty, 
                            RelativeSource={x:Static RelativeSource.Self}, Converter={StaticResource BoolToVisibilityConverter}}"
                            Header="Тип ремонта"
                            Binding="{Binding Warranty}"
                            ElementStyle="{StaticResource Wrap}" />

                    </DataGrid.Columns>

                </DataGrid>

                <!--Карточка ремонта-->
                <ScrollViewer
                    Margin="0 10 20 10"
                    Grid.Row="2"
                    VirtualizingPanel.ScrollUnit="Pixel"
                    VerticalScrollBarVisibility="Hidden">
                    <DockPanel>

                        <StackPanel>

                            <Grid>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition
                                        Width="317*"
                                        MaxWidth="650" />
                                    <ColumnDefinition
                                        Width="309*"
                                        MaxWidth="650" />
                                </Grid.ColumnDefinitions>

                                <StackPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Дата"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />


                                        <DatePicker
                                            SelectedDate="{Binding SelectedRepair.Date}"
                                            Width="200"
                                            Margin="92 0 0 0"
                                            HorizontalAlignment="Right" />
                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Статус"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="85 0 0 0"
                                            ItemsSource="{Binding MainObject.ComboBox.RepairStatus}"
                                            Text="{Binding SelectedRepair.Status}"
                                            DisplayMemberPath="Name"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Тип ОС"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="80 0 0 0"
                                            ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                                            Text="{Binding SelectedRepair.OsName}"
                                            DisplayMemberPath="Name"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Модель"
                                            Margin="20 0 0 0"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="77 0 0 0"
                                            Text="{Binding SelectedRepair.Model}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Серийный номер"
                                            Margin="20 0 0 0"
                                            HorizontalAlignment="Left" />
                                        <TextBox
                                            Width="200"
                                            Margin="24 0 0 0"
                                            Text="{Binding SelectedRepair.SNumber}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Инвентарный номер"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="5 0 0 0"
                                            Text="{Binding SelectedRepair.InvNumber, Converter={StaticResource CharCutConverter}}"
                                            MaxLength="12"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="СЦ ОКС"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="77 0 0 0"
                                            ItemsSource="{Binding MainObject.ComboBox.ScOks}"
                                            Text="{Binding SelectedRepair.ScOks}"
                                            DisplayMemberPath="Name"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Основание"
                                            Width="120"
                                            Margin="20 0 0 0"
                                            TextWrapping="Wrap"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Text="{Binding SelectedRepair.DiagNumber, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource InvConverter}}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="КА поставщик"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="43 0 0 0"
                                            Text="{Binding SelectedRepair.KaProvider}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="КА Ремонт"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="63 0 0 0"
                                            Text="{Binding SelectedRepair.KaRepair}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <StackPanel
                                        VerticalAlignment="Bottom"
                                        Orientation="Horizontal"
                                        Grid.Row="1">

                                        <Button
                                            Content="Записать"
                                            Margin="20 0 0 0"
                                            Command="{Binding ChangeRepair}" />

                                    </StackPanel>

                                </StackPanel>

                                <StackPanel
                                    Grid.Column="1">

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Передал"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="100 0 0 0"
                                            Text="{Binding SelectedRepair.HandedOver}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Неисправность"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="65 0 0 0"
                                            Text="{Binding SelectedRepair.Defect}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">
                                        <TextBlock
                                            Text="Дата отгрузки"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <DatePicker
                                            Width="200"
                                            Margin="72 0 0 0"
                                            SelectedDate="{Binding SelectedRepair.ShipmentDate}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Дней в ремонте"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="63 0 0 0"
                                            Text="{Binding SelectedRepair.DaysOfRepair}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Вернулось из ремонта"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <DatePicker
                                            Width="200"
                                            Margin="29 0 0 0"
                                            SelectedDate="{Binding SelectedRepair.ReturnFromRepair}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">
                                        <TextBlock
                                            Text="Номер заявки поставщика СЦ"
                                            Margin="20 0 0 0"
                                            Width="150"
                                            FontSize="10"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="3 0 0 0"
                                            Text="{Binding SelectedRepair.ProviderOrder}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Согласованная стоимость ремонта"
                                            Margin="20 0 0 0"
                                            Width="150"
                                            FontSize="10"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="3 0 0 0"
                                            Text="{Binding SelectedRepair.RepairBill}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Основание гарантии"
                                            VerticalAlignment="Center"
                                            Margin="20 0 0 0"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="40 0 0 0"
                                            Text="{Binding SelectedRepair.WarrantyBasis}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Дата начала гарантии"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />


                                        <DatePicker
                                            Width="200"
                                            Margin="32 0 0 0"
                                            SelectedDate="{Binding SelectedRepair.StartWarranty}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Тип ремонта"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="85 0 0 0"
                                            Text="{Binding SelectedRepair.Warranty}"
                                            HorizontalAlignment="Right">

                                            <ComboBoxItem
                                                Content="Гарантийный ремонт" />
                                            <ComboBoxItem
                                                Content="Платный ремонт" />

                                        </ComboBox>

                                    </DockPanel>

                                </StackPanel>
                            </Grid>

                        </StackPanel>

                    </DockPanel>
                </ScrollViewer>

            </Grid>

        </Grid>

        <!--Окно устройства-->
        <Grid
            x:Name="Devices"
            Margin="50 0 0 0"
            DataContext="{Binding DevicesViewModel}"
            Visibility="{Binding ActiveVisibility}"
            d:IsHidden="True">

            <Grid.ColumnDefinitions>
                <ColumnDefinition
                    Width="300" />
                <ColumnDefinition
                    Width="705*" />
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition
                    Height="285*" />
                <RowDefinition
                    Height="Auto" />
                <RowDefinition
                    Height="295*" />
                <RowDefinition
                    Height="149*" />
            </Grid.RowDefinitions>

            <GridSplitter
                Grid.Row="1"
                Margin="0 10 0 0"
                Height="3"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Center" />

            <StackPanel
                Margin="0 0 0 10"
                Grid.RowSpan="2">

                <TextBlock
                    Text="Модель устройства"
                    Margin="0 5 0 5" />

                <TextBox
                    Tag="Введите модель устройства"
                    Text="{Binding DeviceName}" />

                <TextBlock
                    Text="Инв.номер устройства"
                    Margin="0 5 0 5" />

                <TextBox
                    Tag="Введите инв.номер устройства"
                    Text="{Binding InvNumber}" />

                <TextBlock
                    Text="Тип ОС"
                    Margin="0 5 0 5" />

                <ComboBox
                    ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                    Text="{Binding OsName}"
                    DisplayMemberPath="Name"
                    Margin="0 0 0 5" />

                <Button
                    Content="Добавить"
                    Command="{Binding AddNewDevice}" />

                <TextBlock
                    Text="Поиск"
                    Margin="0 5 0 5" />

                <TextBox
                    Tag="Введите поисковой запрос"
                    Margin="0 0 0 5"
                    Text="{Binding Filter.SearchLine, UpdateSourceTrigger=PropertyChanged}" />

                <Button
                    Command="{Binding OpenCleanRepairCard}">
                    <TextBlock
                        Text="Добавить ремонт" />
                </Button>

            </StackPanel>

            <TextBlock
                Grid.Row="2"
                Text="Список устройств"
                Margin="0 0 0 0"
                Grid.RowSpan="2" />

            <ListView
                Grid.Row="2"
                Margin="0 20 0 0"
                ItemsSource="{Binding UsersWorks, UpdateSourceTrigger=PropertyChanged}"
                SelectedItem="{Binding SelectedDevice, UpdateSourceTrigger=PropertyChanged}"
                SelectionMode="Single">

                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border
                            BorderThickness="1"
                            BorderBrush="Gray"
                            CornerRadius="3"
                            Width="260">
                            <StackPanel>
                                <DockPanel>
                                    <TextBlock
                                        Foreground="{StaticResource GoldenBrush}"
                                        Text="Модель: " />
                                    <TextBlock
                                        Text="{Binding DeviceName}" />
                                </DockPanel>
                                <DockPanel>
                                    <TextBlock
                                        Foreground="{StaticResource GoldenBrush}"
                                        Text="Инв.Номер: " />
                                    <TextBlock
                                        Text="{Binding InvNumber}" />
                                </DockPanel>
                                <DockPanel>
                                    <TextBlock
                                        Foreground="{StaticResource GoldenBrush}"
                                        Text="Тип ОС: " />
                                    <TextBlock
                                        Text="{Binding OsName}" />
                                </DockPanel>
                                <DockPanel>
                                    <TextBlock
                                        Foreground="{StaticResource GoldenBrush}"
                                        Text="Ремонтов: " />
                                    <TextBlock
                                        Text="{Binding Repairs.Count}" />
                                </DockPanel>
                            </StackPanel>

                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>

            </ListView>

            <StackPanel
                Grid.Row="3">

                <TextBlock
                    Text="Выбранная модель" />

                <TextBox
                    Text="{Binding SelectedDevice.DeviceName}" />

                <TextBlock
                    Text="Инвентарный номер" />

                <TextBox
                    Text="{Binding SelectedDevice.InvNumber}" />

                <TextBlock
                    Text="Тип ОС" />

                <ComboBox
                    ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                    Text="{Binding SelectedDevice.OsName}"
                    DisplayMemberPath="Name" />

                <Button
                    HorizontalAlignment="Left"
                    Content="Записать"
                    Margin="0 5 0 0"
                    Command="{Binding ChangeDevice}" />

                <Button
                    HorizontalAlignment="Right"
                    Margin="0 -30 0 0"
                    Command="{Binding LoadRepairs}">

                    <TextBlock
                        Text="Загрузить Excel" />
                </Button>

            </StackPanel>

            <Grid
                Grid.Column="1"
                Grid.RowSpan="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition
                        Width="151*" />
                    <ColumnDefinition
                        Width="824*" />
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition
                        Height="335*" />
                    <RowDefinition
                        Height="Auto
                        " />
                    <RowDefinition
                        Height="391*" />
                </Grid.RowDefinitions>

                <GridSplitter
                    Margin="10 10 0 10"
                    Grid.Row="1"
                    Grid.ColumnSpan="2"
                    Height="3"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center" />

                <DataGrid
                    ItemsSource="{Binding SelectedDevice.Repairs, UpdateSourceTrigger=PropertyChanged}"
                    SelectedItem="{Binding SelectedRepair, UpdateSourceTrigger=PropertyChanged}"
                    CanUserAddRows="False"
                    CanUserReorderColumns="True"
                    HeadersVisibility="Column"
                    CanUserDeleteRows="True"
                    SelectionUnit="FullRow"
                    SelectionMode="Extended"
                    IsReadOnly="True"
                    AutoGenerateColumns="False"
                    BorderThickness="0.5"
                    Margin="10 0 0 0"
                    Grid.ColumnSpan="2">

                    <DataGrid.Resources>

                    </DataGrid.Resources>

                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem
                                Header="Переместить"
                                Command="{Binding OpenSwitchDevicerepair}" />
                        </ContextMenu>
                    </DataGrid.ContextMenu>

                    <DataGrid.Columns>

                        <DataGridTextColumn
                            Header="Дата"
                            Binding="{Binding Date, StringFormat='{}{0:dd.MM.yyy}'}" />

                        <DataGridTextColumn
                            Header="Статус"
                            Binding="{Binding Status}">

                            <DataGridTextColumn.ElementStyle>
                                <Style
                                    TargetType="TextBlock">
                                    <Setter
                                        Property="Foreground"
                                        Value="{Binding Status, Converter={StaticResource RepairsTextColorConverter}}" />
                                    <Setter
                                        Property="TextWrapping"
                                        Value="Wrap" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>

                        </DataGridTextColumn>

                        <DataGridTextColumn
                            Header="Наименование"
                            Binding="{Binding OsName}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Модель"
                            Binding="{Binding Model}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Серийный номер"
                            Binding="{Binding SNumber}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Инв.номер"
                            Binding="{Binding InvNumber}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Основание"
                            Binding="{Binding DiagNumber}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="КА поставщик"
                            Binding="{Binding KaProvider}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="КА ремонт"
                            Binding="{Binding KaRepair}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Передал"
                            Binding="{Binding HandedOver}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Неисправность"
                            Binding="{Binding Defect}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Дата отгрузки"
                            Binding="{Binding ShipmentDate, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Дней в ремонте"
                            Binding="{Binding DaysOfRepair}">

                            <DataGridTextColumn.ElementStyle>
                                <Style
                                    TargetType="TextBlock">
                                    <Setter
                                        Property="Foreground"
                                        Value="{Binding DaysOfRepair, Converter={StaticResource RepairsTextColorConverter}}" />
                                    <Setter
                                        Property="TextWrapping"
                                        Value="Wrap" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>

                        </DataGridTextColumn>

                        <DataGridTextColumn
                            Header="Вернулось из ремонта"
                            Binding="{Binding ReturnFromRepair, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Номер заявки поставщика СЦ"
                            Binding="{Binding ProviderOrder}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Согласованная стоимость ремонта"
                            Binding="{Binding RepairBill}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Основание гарантии"
                            Binding="{Binding WarrantyBasis}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Дата начала гарантии"
                            Binding="{Binding StartWarranty, StringFormat='{}{0:dd.MM.yyy}'}"
                            ElementStyle="{StaticResource Wrap}" />

                        <DataGridTextColumn
                            Header="Гарантия"
                            Binding="{Binding Warranty}"
                            ElementStyle="{StaticResource Wrap}" />

                    </DataGrid.Columns>

                </DataGrid>

                <!--Карточка ремонта-->

                <ScrollViewer
                    Margin="10,10,0,0"
                    Grid.Row="2"
                    Grid.ColumnSpan="2"
                    VerticalScrollBarVisibility="Hidden">
                    <DockPanel
                        Margin="0 10 20 10">
                        <StackPanel>

                            <Grid>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition
                                        Width="317*"
                                        MaxWidth="650" />
                                    <ColumnDefinition
                                        Width="309*"
                                        MaxWidth="650" />
                                </Grid.ColumnDefinitions>

                                <StackPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Дата"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />


                                        <DatePicker
                                            SelectedDate="{Binding SelectedRepair.Date}"
                                            Width="200"
                                            Margin="92 0 0 0"
                                            HorizontalAlignment="Right" />
                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Статус"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="85 0 0 0"
                                            ItemsSource="{Binding MainObject.ComboBox.RepairStatus}"
                                            Text="{Binding SelectedRepair.Status}"
                                            DisplayMemberPath="Name"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Тип ОС"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="80 0 0 0"
                                            ItemsSource="{Binding MainObject.ComboBox.OsTypeList}"
                                            Text="{Binding SelectedRepair.OsName}"
                                            DisplayMemberPath="Name"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Модель"
                                            Margin="20 0 0 0"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="77 0 0 0"
                                            Text="{Binding SelectedRepair.Model}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Серийный номер"
                                            Margin="20 0 0 0"
                                            HorizontalAlignment="Left" />
                                        <TextBox
                                            Width="200"
                                            Margin="24 0 0 0"
                                            Text="{Binding SelectedRepair.SNumber}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Инвентарный номер"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="5 0 0 0"
                                            Text="{Binding SelectedRepair.InvNumber, Converter={StaticResource CharCutConverter}}"
                                            MaxLength="12"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="СЦ ОКС"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="77 0 0 0"
                                            ItemsSource="{Binding MainObject.ComboBox.ScOks}"
                                            Text="{Binding SelectedRepair.ScOks}"
                                            DisplayMemberPath="Name"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Основание"
                                            Width="120"
                                            Margin="20 0 0 0"
                                            TextWrapping="Wrap"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Text="{Binding SelectedRepair.DiagNumber, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource InvConverter}}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="КА поставщик"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="43 0 0 0"
                                            Text="{Binding SelectedRepair.KaProvider}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="КА Ремонт"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="63 0 0 0"
                                            Text="{Binding SelectedRepair.KaRepair}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <StackPanel
                                        VerticalAlignment="Bottom"
                                        Orientation="Horizontal"
                                        Grid.Row="1">

                                        <Button
                                            Content="Записать"
                                            Margin="20 0 0 0"
                                            Command="{Binding ChangeRepair}" />

                                    </StackPanel>

                                </StackPanel>

                                <StackPanel
                                    Grid.Column="1">

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Передал"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="100 0 0 0"
                                            Text="{Binding SelectedRepair.HandedOver}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Неисправность"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="65 0 0 0"
                                            Text="{Binding SelectedRepair.Defect}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">
                                        <TextBlock
                                            Text="Дата отгрузки"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <DatePicker
                                            Width="200"
                                            Margin="72 0 0 0"
                                            SelectedDate="{Binding SelectedRepair.ShipmentDate}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Дней в ремонте"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="63 0 0 0"
                                            Text="{Binding SelectedRepair.DaysOfRepair}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Вернулось из ремонта"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <DatePicker
                                            Width="200"
                                            Margin="29 0 0 0"
                                            SelectedDate="{Binding SelectedRepair.ReturnFromRepair}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">
                                        <TextBlock
                                            Text="Номер заявки поставщика СЦ"
                                            Margin="20 0 0 0"
                                            Width="150"
                                            FontSize="10"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="3 0 0 0"
                                            Text="{Binding SelectedRepair.ProviderOrder}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Согласованная стоимость"
                                            Margin="20 0 0 0"
                                            Width="150"
                                            FontSize="10"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="3 0 0 0"
                                            Text="{Binding SelectedRepair.RepairBill}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Основание гарантии"
                                            VerticalAlignment="Center"
                                            Margin="20 0 0 0"
                                            HorizontalAlignment="Left" />

                                        <TextBox
                                            Width="200"
                                            Margin="40 0 0 0"
                                            Text="{Binding SelectedRepair.WarrantyBasis}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Дата начала гарантии"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />


                                        <DatePicker
                                            Width="200"
                                            Margin="32 0 0 0"
                                            SelectedDate="{Binding SelectedRepair.StartWarranty}"
                                            HorizontalAlignment="Right" />

                                    </DockPanel>

                                    <DockPanel
                                        Margin="0 0 0 10">

                                        <TextBlock
                                            Text="Тип ремонта"
                                            Margin="20 0 0 0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left" />

                                        <ComboBox
                                            Width="200"
                                            Margin="85 0 0 0"
                                            Text="{Binding SelectedRepair.Warranty}"
                                            HorizontalAlignment="Right">

                                            <ComboBoxItem
                                                Content="Гарантийный ремонт" />
                                            <ComboBoxItem
                                                Content="Платный ремонт" />

                                        </ComboBox>

                                    </DockPanel>

                                </StackPanel>
                            </Grid>

                        </StackPanel>
                    </DockPanel>
                </ScrollViewer>

            </Grid>

        </Grid>

        <!--Шторка-->
        <Grid
            HorizontalAlignment="Left"
            Width="40">

            <Grid.RowDefinitions>
                <RowDefinition
                    Height="139*" />
                <RowDefinition
                    Height="40" />
            </Grid.RowDefinitions>

            <StackPanel
                x:Name="LeftMenuPanel"
                Width="40"
                HorizontalAlignment="Left"
                Background="#3d3d3d">

                <Button
                    x:Name="UserWorksButton"
                    Command="{Binding ViewModelsVisibility}"
                    CommandParameter="User"
                    MouseEnter="LeftMenuButton_MouseEnter"
                    MouseLeave="LeftMenuButton_MouseLeave">

                    <Image
                        Source="/Resources/User1.png" />

                    <Button.Style>
                        <Style
                            BasedOn="{StaticResource MenuButton}"
                            TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding UserWorksViewModel.ActiveVisibility}"
                                    Value="Visible">
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    x:Name="AllOrdersButton"
                    IsEnabled="{Binding MainObject.Access.VisibilityControl}"
                    Command="{Binding ViewModelsVisibility}"
                    CommandParameter="AllWorks"
                    MouseEnter="LeftMenuButton_MouseEnter"
                    MouseLeave="LeftMenuButton_MouseLeave">

                    <Image
                        Source="/Resources/AllOrders.png" />

                    <Button.Style>
                        <Style
                            BasedOn="{StaticResource MenuButton}"
                            TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding AllWorksViewModel.ActiveVisibility}"
                                    Value="Visible">
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    x:Name="AllRepairsButton"
                    IsEnabled="{Binding MainObject.Access.VisibilityRepairs}"
                    Command="{Binding ViewModelsVisibility}"
                    CommandParameter="Repairs"
                    MouseEnter="LeftMenuButton_MouseEnter"
                    MouseLeave="LeftMenuButton_MouseLeave">

                    <Image
                        Source="/Resources/Wrench.png" />

                    <Button.Style>
                        <Style
                            BasedOn="{StaticResource MenuButton}"
                            TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding RepairsViewModel.ActiveVisibility}"
                                    Value="Visible">
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    x:Name="DevicesButton"
                    IsEnabled="{Binding MainObject.Access.VisibilityDevices}"
                    Command="{Binding ViewModelsVisibility}"
                    CommandParameter="Devices"
                    MouseEnter="LeftMenuButton_MouseEnter"
                    MouseLeave="LeftMenuButton_MouseLeave">

                    <Image
                        Source="/Resources/Devices.png" />
                    <Button.Style>
                        <Style
                            BasedOn="{StaticResource MenuButton}"
                            TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding DevicesViewModel.ActiveVisibility}"
                                    Value="Visible">
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    x:Name="AdministrateButton"
                    IsEnabled="{Binding MainObject.Access.VisibilityControlSql}"
                    Command="{Binding ViewModelsVisibility}"
                    CommandParameter="Administrate"
                    MouseEnter="LeftMenuButton_MouseEnter"
                    MouseLeave="LeftMenuButton_MouseLeave">

                    <Image
                        Source="/Resources/Settings.png" />

                    <Button.Style>
                        <Style
                            BasedOn="{StaticResource MenuButton}"
                            TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding AdministrateViewModel.ActiveVisibility}"
                                    Value="Visible">
                                    <Setter
                                        Property="Background"
                                        Value="{StaticResource DarkBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

            </StackPanel>

            <Button
                Grid.Row="1"
                x:Name="ChangeServerButton"
                VerticalAlignment="Bottom"
                MouseEnter="LeftMenuButton_MouseEnter"
                MouseLeave="LeftMenuButton_MouseLeave"
                Background="#3d3d3d"
                Style="{StaticResource MenuButton}"
                Width="Auto"
                Command="{Binding ChangeServer}">

                <Image
                    Source="/Resources/Server_White.png" />
            </Button>

        </Grid>

        <Popup
            x:Name="popupUC"
            AllowsTransparency="True"
            HorizontalOffset="0"
            VerticalOffset="-5">

            <Grid>
                <local1:PopupUserControl
                    x:Name="Header"
                    Foreground="#FFFFFF" />
            </Grid>

        </Popup>

    </Grid>
</Window>
    
    
    